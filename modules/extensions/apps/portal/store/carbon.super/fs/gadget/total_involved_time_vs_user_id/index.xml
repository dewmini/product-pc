<?xml version="1.0" encoding="UTF-8" ?>
<!--
~ Copyright (c) 2016, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~      http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
-->
<!--Gadget definition start-->
<Module>
    <!--Gadget name, description, tags etc.. goes here-->
    <ModulePrefs title="PC Analytics"
                 height="350"
                 description="This shows pc analytics charts"
                 tags="analytics">
        <Require feature="dynamic-height"/>
        <Require feature="wso2-gadgets-controls"/>
        <Require feature="pubsub-2">
            <Param name="topics">
                <![CDATA[
                <Topic title="PC Analytics"
                    name="org.wso2.ues.samples.ch"
                    type="object"
                    subscribe="true"/>
               ]]>
            </Param>
        </Require>
    </ModulePrefs>

    <Content type="html">
        <![CDATA[
        <html>
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Bar Chart Test</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/portal/libs/bootstrap_3.3.5/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/portal/libs/pc-analytics-libs/css/bootstrap.min.css"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/portal/libs/pc-analytics-libs/css/VizGrammar.css"/>

    <script src="/portal/libs/jquery_1.11.0/jquery-1.11.3.min.js"></script>

    <script src="/portal/libs/pc-analytics-libs/js/bootstrap.min.js"></script>
    <script src="/portal/libs/analytics-wso2_5.0.12/d3.min.js"></script>
    <script src="/portal/libs/pc-analytics-libs/js/topojson.js"></script>
    <script src="/portal/libs/analytics-wso2_5.0.12/vega.js"></script>
    <script src="/portal/libs/analytics-wso2_5.0.12/VizGrammar.min.js"></script>
    <script src="/portal/libs/pc-analytics-libs/js/VizGrammarSettings.js"></script>
    <script src="js/actions.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>
    <script>
        gadgets.HubSettings.onConnect = function() {
            gadgets.Hub.subscribe('channel5', function(topic, data, subscriberData) {
                if(data.type === 'clear') {
                    return;
                }
                wso2.gadgets.controls.showGadget();
                var start = new Date(data.from);
                var startDate=start.getFullYear()+"-"+(start.getMonth()+1)+"-"+start.getDate();
                var end=new Date(data.to);
                var endDate=end.getFullYear()+"-"+(end.getMonth()+1)+"-"+end.getDate();

                $("#StartDate").val(startDate);
                $("#EndDate").val(endDate);
                $("#from").val(data.from);
                $("#to").val(data.to);
                drawGraph();
            });
        };
    </script>
</head>

<body>
    <div class="panel panel-default">
        <div class="panel-body">
            <div style="padding-top: 10px;padding-left: 10px;padding-right: 10px;">
                <div class="form-inline" role="form">
                    <div class="input-group form-group">
                        <label class="input-group-addon" for="StartDate">Start Date</label>
                        <input id="StartDate" name="StartDate" type="text" class="form-control" readonly/>
                    </div>
                    <div class="input-group form-group">
                        <label class="input-group-addon" for="EndDate">End Date</label>
                        <input id="EndDate" name="EndDate" type="text" class="form-control" readonly/>
                    </div>
                    <div class="form-group">
                        <select id="TasksOrder" class="selectpicker form-control">
                            <option value="top">Top</option>
                            <option value="bottom">Bottom</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="TasksCount" class="selectpicker form-control"
                                onchange="selectPickerValChange(this)">
                            <option value="other">Set a new value</option>
                            <option selected="selected" value="3">3</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <input id="from" type="hidden"/>
                    <input id="to" type="hidden"/>

                    <button class="btn btn-primary" onclick="drawGraph()">Apply Filter</button>
                </div>
            </div>
            <div id="chartA"></div>
        </div>
    </div>

    <script type="text/javascript">

        var config = {
            type: "bar",
            x : "User",
            highlight : "multi",
            charts : [{type: "bar", y : "Time"}],
            maxLength: 6,
            transform:[60,70],
            width: 800,
            height: 400,
            padding: 80
        }

        var callbackmethod = function(event, item) {
            alert('chart clicked');
        }

        window.onload = function() {
            $('.selectpicker').selectpicker({
                style: 'btn',
                size: 4
            });

            var today = new Date();
            $("#EndDate").val(today.getFullYear()+"-"+(today.getMonth()+1)+"-"+today.getDate());
            $("#to").val(today.getTime());
            var startDate = new Date(2016,0,1);
            $("#StartDate").val(startDate.getFullYear()+"-"+(startDate.getMonth()+1)+"-"+startDate.getDate());
            $("#from").val(startDate.getTime());

            $.getJSON("/portal/store/carbon.super/fs/gadget/total_involved_time_vs_user_id/js/meta-data-totalInvolvedTimeVsUserID.json.js",
            function(result){
                $.each(result, function(i, field){
                    jsonObj.push(field);
                    drawGraph();
                });
            });
        }
    </script>
</body>
</html>
     ]]>
    </Content>
</Module>