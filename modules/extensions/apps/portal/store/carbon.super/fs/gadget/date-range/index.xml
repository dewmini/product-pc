<?xml version="1.0" encoding="UTF-8" ?>
<!--
~ Copyright (c) 2016, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~      http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
-->
<Module>
    <ModulePrefs title="Date Range Picker" height="1000">
        <Require feature="pubsub-2"/>
        <Require feature="dynamic-height"/>
        <Require feature="wso2-gadgets-controls"/>
    </ModulePrefs>
    <Content type="html">
        <![CDATA[
            <html>
<head>
    <meta charset="utf-8"/>
    <title>jQuery UI Datepicker - Default functionality</title>
    <link rel="stylesheet" href="/portal/libs/bootstrap_3.3.5/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/bootstrap-datepicker.min.css" type="text/css"/>
    <style>
        .datepicker-inline {
            margin:0 auto;
        }
    </style>
    <script src="/portal/libs/jquery_1.11.0/jquery-1.11.3.min.js"></script>
    <script src="/portal/libs/bootstrap_3.3.5/js/bootstrap.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script>
        var from = 0;
        var to = 0;

        $(function() {

            $("#fromDate").datepicker({
            orientation: 'top'
            }).on('changeDate', function(e) {
                var fromdate = e.date;
                from = fromdate.getTime();
                $("#startDate").val(fromdate.getFullYear()+"-"+(fromdate.getMonth()+1)+"-"+fromdate.getDate());
                $("#fromDate").hide();
            });

            wso2.gadgets.controls.addLostFocusListener(function() {
                $( "#fromDate" ).hide();
                $( "#toDate" ).hide();
            });

            $("#toDate").datepicker({
            orientation: 'top'
            }).on('changeDate', function(e) {
                var todate = e.date;
                to = todate.getTime();
                $("#endDate").val(todate.getFullYear()+"-"+(todate.getMonth()+1)+"-"+todate.getDate());
                $("#toDate").hide();
            });
        });

        function publish() {
            if((from!=0) && (to!=0)){
                gadgets.Hub.publish('date_range', {
                from: from,
                to: to
                });
                from = 0;
                to = 0;
                alert("Data published successfully!");
            }
            else{
                alert('Please fill both dates');
            }
        }
    </script>
</head>
<body>
    <div class="panel panel-default">
        <div class="panel-body">
            <div style="padding-top: 10px;padding-left: 10px;padding-right: 10px;">
                <div class="form-inline" role="form">
                    <div class="input-group form-group">
                        <label class="input-group-addon" id="start_date" for="startDate">Start Date</label>
                        <input id="startDate" class="form-control" type="text" onfocus="setStartDatePicker()"/>
                    </div>
                    <div class="input-group form-group">
                        <label class="input-group-addon" id="start_date">End Date</label>
                        <input id="endDate" class="form-control" type="text" onfocus="setEndDatePicker()"/>
                    </div>
                    <Button class="btn btn-default btn-info" id="applyBtn" onclick="publish()">Publish</Button>
                    <Button class="btn btn-default btn-info" id="resetBtn" onclick="reset()">Reset</Button>
                </div>
            </div>
            <div id="fromDate" style="display:none;width: 10%;margin-left:70px;"></div>
            <div id="toDate" style="display:none;width: 10%;margin-left:350px;"></div>
        </div>
    </div>
    <script type="text/javascript">
        function setStartDatePicker(){
            $("#fromDate").show();
            $("#toDate").hide();
        }

        function setEndDatePicker(){
            $("#fromDate").hide();
            $("#toDate").show();
        }

        function reset(){
            $("#startDate").val("");
            $("#endDate").val("");
            $("#fromDate").hide();
            $("#toDate").hide();
        }
    </script>
</body>
</html>
        ]]>
    </Content>
</Module>